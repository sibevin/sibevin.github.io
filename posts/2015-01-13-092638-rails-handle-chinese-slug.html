<div class="meta"><div class="title">處理rails中文slug</div><div class="datetime">2015-01-13 09:26:38</div><div class="tag">rails</div><div class="category">programming</div><div class="link">rails-handle-chinese-slug</div><div class="file">2015-01-13-092638-rails-handle-chinese-slug</div><div class="template">post</div></div><h2>使用friendly_id支援slug</h2><p>1. 在migration中加入一個slug的col。</p><div hljs="" include="&#39;code1&#39;" language="ruby"></div><script id="code1" type="text/ng-template">class CreateBlogPosts < ActiveRecord::Migration
  def change
    create_table :blog_posts do |t|
      # ...
      t.string :title
      t.string :slug, null: false
      # ...
    end
    add_index :blog_posts, :slug, unique: true
  end
end</script><p>2. 在model中設定friendly_id。friendly_id會在model被建立的時候將一個指定的欄位(以這個例子而言就是title)轉成網址用的slug並存在slug這個欄位中。</p><div hljs="" include="&#39;code2&#39;" language="ruby"></div><script id="code2" type="text/ng-template">class BlogPost < ActiveRecord::Base
  extend FriendlyId
  friendly_id :title, use: :slugged
  # ...
end</script><p>3. 在controller中如果要用<code>params[:id]</code>找對應的record，要記得加上friendly。</p><div hljs="" include="&#39;code3&#39;" language="ruby"></div><script id="code3" type="text/ng-template">class BlogPostsController < ApplicationController
  before_action :set_blog_post, only: [:show, :edit, :update, :destroy]
  # ...
  private


    def set_blog_post
      @blog_post = BlogPost.friendly.find(params[:id])
    end
end</script><p>目前friendly_id只能支援英文的slug，如果有中文字就會被強迫變成-，這時候就要用babosa了。</p><h2>加上babosa支援中文slug</h2><p>在model中override<code>normalize_friendly_id</code>。</p><div hljs="" include="&#39;code4&#39;" language="ruby"></div><script id="code4" type="text/ng-template">class BlogPost < ActiveRecord::Base
  extend FriendlyId
  friendly_id :title, use: :slugged
  # ...

  def normalize_friendly_id(input)
    input.to_s.to_slug.normalize.to_s
  end

  # ...

  private

    def gen_ubid
      self.ubid = RandomToken.gen(64)
    end
end</script><h1>Refs</h1><ul><li><a href="http://blog.roachking.net/blog/2014/01/17/babosa-friendly-id-solve-chinese-problems/" target="_blank">使用 Babosa 配合 Friendly_id 解決中文網址問題 - by 蟑螂窩</a></li></ul>
