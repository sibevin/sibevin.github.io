<div class="meta"><div class="title">如何將顯示在view中變數值傳給AngularJS</div><div class="datetime">2014-11-01 11:59:58</div><div class="tag">angularjs rails</div><div class="category">programming</div><div class="link">pass-variables-from-server-to-angular-with-view</div><div class="file">2014-11-01-115958-pass-variables-from-server-to-angular-with-view</div><div class="template">post</div></div><h1>問題</h1><p>在某些情況下，我們希望能將在view中使用的變數傳給AngularJS的變數來使用，舉個例子來說：</p><div hljs="" include="'code4'"></div><script id="code4" type="text/ng-template"><form action="profile" method="put">
  <input type="text" name="name" value="<%= @profile.name%>" />
</form></script><p>如果當<code>@profile</code>有值的時候，我們希望可以將<code>@profile.name</code>帶給input做為初始化的值。但用了ng-model之後，two-way binding的效果變成我們要將<code>@profile.name</code>的值帶到AngularJS中<code>$scope.profile.name</code>這個變數中。</p><div hljs="" include="'code5'"></div><script id="code5" type="text/ng-template"><form action="profile" method="put">
  <input type="text" name="name" ng-model="profile.name" />
</form></script><p>其實將變數從server傳給angular的方式很多，最標準的做法就是使用http API的方式讓angular去call，不過如果只是用在view中的變數，建API似乎有點太over了。另外原本render view就要一個requrest，使用API去取得變數又要另一個request，這樣就變成有點累贅。</p><h1>解法</h1><p>找了許多的做法之後，看起來還是使用module constant最乾淨。步驟如下：</p><p>1. 在rails controller中將@profile轉成json格式：</p><div hljs="" include="'code1'" language="ruby"></div><script id="code1" type="text/ng-template">@profile = profile.to_json</script><p>2. 在rails view中加入javascript的程式碼，設定module constant：</p><div hljs="" include="'code2'" language="html"></div><script id="code2" type="text/ng-template"><script type="text/javascript">angular.module("MyApp").constant("PROFILE_DATA", <%= @profile.html_safe %>)</script></script><p>3. 在angular controller中使用module constant：</p><div hljs="" include="'code3'" language="coffeescript"></div><script id="code3" type="text/ng-template">angular.module("MyApp").controller "ProfileEditCtrl", [
  '$scope', 'PROFILE_DATA'
  ($scope,   PROFILE_DATA) ->


    $scope.profile = PROFILE_DATA

]</script><h1>Refs</h1><ul><li><a href="http://www.mircozeiss.com/how-to-pass-javascript-variables-from-a-server-to-angular/" target="_blank">How to pass JavaScript variables from a server to AngularJS</a></li><li><a href="http://www.linkplugapp.com/a/224929" target="_blank">Frictionless data preloading in AngularJSFrictionless data preloading in AngularJS</a></li></ul>