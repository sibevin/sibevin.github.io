<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><title>rails è®€æ›¸æœƒ - POODR - Ch7 ä½¿ç”¨moduleä¾†åˆ†äº«è§’è‰²çš„è¡Œç‚º</title><meta content="" name="description" /><meta content="rails è®€æ›¸æœƒ - POODR - Ch7 ä½¿ç”¨moduleä¾†åˆ†äº«è§’è‰²çš„è¡Œç‚º" property="og:title" /><meta content="" property="og:description" /><meta content="é­”æ³•å¸«çš„æ‰‹æ–" property="og:site_name" /><link href="//cdn.jsdelivr.net/highlight.js/8.7.0/styles/hybrid.min.css" rel="stylesheet" /><link href="/css/application.css" rel="stylesheet" /><link href="/favicon.ico?" rel="shortcut icon" type="image/x-icon" /><script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script><script src="//cdn.jsdelivr.net/highlight.js/8.7.0/highlight.min.js"></script><script src="//cdn.jsdelivr.net/lodash/3.10.1/lodash.min.js"></script><script src="/js/vendor/angular-tau-utils.min.js"></script><script src="/js/vendor/focusIf.min.js"></script><script src="/js/app.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-26486503-2', 'auto');
ga('send', 'pageview');</script></head><body class="theme-color-default layout" ng-class="{&#39;lo-menu-open&#39;:footer_ts.isTab(&#39;menu&#39;)}" ng-controller="LayoutCtrl" ng-keydown="layoutKeyDown($event)"><div class="main-container"><section class="main"><script>angular.module("scsBlogApp").constant("CURRENT_FILE", "2015-10-18-184234-ruby-poodr-ch7-sharing-role-behavior-with-modules")</script><div class="post" ng-controller="PostCtrl"><div class="title"><div class="title-img"><a href="/drafts"><img src="/images/menu/paper_76x.svg" /></a></div><div class="title-main"><div class="title-text">rails è®€æ›¸æœƒ - POODR - Ch7 ä½¿ç”¨moduleä¾†åˆ†äº«è§’è‰²çš„è¡Œç‚º</div><div class="title-info"><div class="title-time"><div class="time">2015-10-18 18:42:34</div></div><div class="title-tcs"><div class="tag" ng-repeat="tag in getPostTags(current_post)" ng-style="{&#39;background-color&#39;:tag.color}"><a class="tag-link" ng-href="/tags?t={{tag.code}}">{{tag.name}}</a></div><div class="category-icon"><a ng-href="/categories?c={{getPostCategory(current_post).code}}"><div class="ca-icon-{{getPostCategory(current_post).code}}"></div></a></div></div></div></div></div><div class="content"><div class="draft">DRAFT</div><div class="meta-data">title rails è®€æ›¸æœƒ - POODR - Ch7 ä½¿ç”¨moduleä¾†åˆ†äº«è§’è‰²çš„è¡Œç‚º</div><div class="meta-data">datetime 2015-10-18 18:42:34</div><div class="meta-data">tags ruby,ooad,rails_study-group</div><div class="meta-data">category coding</div><div class="meta-data">link ruby-poodr-ch7-sharing-role-behavior-with-modules</div><div class="meta-data">file 2015-10-18-184234-ruby-poodr-ch7-sharing-role-behavior-with-modules</div><div class="meta-data">template post</div><div class="meta-data">draft</div><div class="meta-data">end</div><ul><li>rubyçš„ç¹¼æ‰¿ç„¡æ³•è™•ç†å¤šé‡ç¹¼æ‰¿ã€‚</li><li>ä½¿ç”¨åˆ†äº«è§’è‰²çš„æ–¹å¼å–ä»£ç¹¼æ‰¿ã€‚</li></ul><h1>Understanding Roles</h1><p>è§’è‰²çš„å®šç¾©ï¼šå¤šå€‹ä¸ç›¸é—œçš„classæ“æœ‰ç›¸åŒçš„è¡Œç‚ºï¼Œæˆ‘å€‘æŠŠå®ƒå®šç¾©æˆé€™äº›classåœ¨æ‰®æ¼”åˆ†äº«åŒä¸€å€‹è§’è‰²ã€‚é€™äº›classå°±æœƒæœ‰ä¸€å€‹æ‰®æ¼”ç›¸åŒè§’è‰²çš„ç›¸ä¾æ€§ï¼Œé€™ç¨®ç›¸ä¾æ€§åœ¨è¨­è¨ˆçš„æ™‚å€™å°±è¦è€ƒæ…®é€²ä¾†ã€‚</p><h2>Finding Roles</h2><p>duck typingå°±æ˜¯ä¸€ç¨®è§’è‰²çš„æ¦‚å¿µã€‚èˆ‡ç¬¬5ç« çš„duck typingä¸åŒçš„æ˜¯æˆ‘å€‘æƒ³çµ„ç¹”åˆ†äº«çš„è¡Œç‚ºï¼Œé€šå¸¸æˆ‘å€‘æœƒå°‡åˆ†äº«çš„è¡Œç‚ºå®šç¾©åœ¨æŸå€‹æª”æ¡ˆä¸­æ–¹ä¾¿ä½¿ç”¨èˆ‡åƒç…§ï¼Œrubyçš„moduleå°±éå¸¸é©åˆç”¨ä¾†å®šç¾©å…±ç”¨çš„methodã€‚</p><p>ä¸€æ—¦åœ¨classä½¿ç”¨äº†moduleä¾†å…±ç”¨methodï¼Œclasså¯ä»¥å‘¼å«çš„methodå°±æœƒæ“´å¤§ï¼ŒåŸºæœ¬ä¸ŠåŒ…å«äº†ï¼š</p><ul><li>1. classè‡ªå·±å¯¦ä½œçš„methodã€‚</li><li>2. classç”±ç¹¼æ‰¿é«”ç³»å¾—çŸ¥çš„methodã€‚</li><li>3. classç”±include moduleå…±ç”¨çš„methodã€‚</li><li>4. classç”±ç¹¼æ‰¿é«”ç³»ä¸­çš„classï¼Œé€™äº›classè£¡include moduleå…±ç”¨çš„methodã€‚</li></ul><h2>Organizing Responsibilities</h2><ul><li>é¸æ“‡å“ªä¸€äº›methodéœ€è¦å…±ç”¨çš„æ–¹æ³•ï¼Œå°±å¦‚åŒä¹‹å‰è¦åŠƒæ‰¿ç¹¼æ¶æ§‹ä¸­æ‰€æåˆ°çš„æ–¹æ³•ã€‚</li></ul><h2>Removing Unnecessary Dependencies</h2><h2>Writing the Concrete Code</h2><p>Bicycleä¸­æœ‰ä¸€ç³»åˆ—æœ‰é—œscheduleçš„methodç”¨ä¾†è™•ç†æ’ç¨‹çš„å•é¡Œã€‚</p><pre><code>class Bicycle
  attr_reader :schedule, :size, :chain, :tire_size
  # Inject the Schedule and provide a default
  def initialize(args={})
    <span class="mk-blue">@schedule = args[:schedule] || Schedule.new</span>
    # ...
  end
  # Return true if this bicycle is available
  # during this (now Bicycle specific) interval.
  <span class="mk-blue">def schedulable?(start_date, end_date)</span>
    !scheduled?(start_date - lead_days, end_date)
  end
  # Return the schedule's answer
  <span class="mk-blue">def scheduled?(start_date, end_date)</span>
    schedule.scheduled?(self, start_date, end_date)
  end
  # Return the number of lead_days before a bicycle
  # can be scheduled.
  <span class="mk-blue">def lead_days</span>
    1
  end
  # ...
end

require 'date'
starting = Date.parse("2015/09/04")
ending = Date.parse("2015/09/10")
b = Bicycle.new b.schedulable?(starting, ending)
# This Bicycle is not scheduled
# between 2015-09-03 and 2015-09-10
# => true</code></pre><p>ä½†æˆ‘å€‘ç™¼ç¾é™¤äº†Bicycleå¤–ï¼Œé‚„æœ‰Vehicleèˆ‡Mechanicä¹Ÿæœ‰ç›¸åŒscheduleçš„éœ€æ±‚ï¼Œé™¤äº†<code>lead_days</code>ä¸åŒä¹‹å¤–ï¼Œ<code>schedulable?</code>èˆ‡<code>scheduled?</code>çš„methodéƒ½ä¸€æ¨£ã€‚</p><h2>Extracting the Abstraction</h2><p>ç‚ºäº†è¦å…±ç”¨methodï¼Œæˆ‘å€‘å°‡scheduleç›¸é—œçš„methodå¾BicycleæŠ½å‡ºä¾†æ”¾åˆ°schedulableé€™å€‹moduleä¸­ã€‚</p><pre><code>module Schedulable
  attr_writer :schedule
  def schedule
    @schedule ||= ::Schedule.new
  end

  def schedulable?(start_date, end_date)
    !scheduled?(start_date - lead_days, end_date)
  end

  def scheduled?(start_date, end_date)
    schedule.scheduled?(self, start_date, end_date)
  end

  # includers may override
  def lead_days
    0
  end
end</code></pre><p>é€™æ™‚å€™Bicycleå°±å¯ä»¥æ”¹å¯«æˆï¼š</p><pre class="ruby"><code>class Bicycle
  <span class="mk-blue">include Schedulable</span>
  <span class="mk-blue">def lead_days</span>
    1
  end
  # ...
end

require 'date'
starting = Date.parse("2015/09/04")
ending = Date.parse("2015/09/10")
ï¿¼ï¿¼b = Bicycle.new b.schedulable?(starting, ending)
# This Bicycle is not scheduled
# between 2015-09-03 and 2015-09-10
# => true</code></pre><p>æ”¹æˆé€™æ¨£çš„å¥½è™•æ˜¯Vehicleèˆ‡Mechanicå°±æ¡ç”¨åŒæ¨£çš„æ–¹æ³•å°±å¯ä»¥ç›´æ¥æ“æœ‰scheduleç›¸é—œçš„methodã€‚</p><pre class="ruby"><code>class Vehicle
  <span class="mk-blue">include Schedulable</span>
  <span class="mk-blue">def lead_days</span>
    3
  end
  # ...
end

class Mechanic
  <span class="mk-blue">include Schedulable</span>
  <span class="mk-blue">def lead_days</span>
    4
  end
  # ...
end

v = Vehicle.new v.schedulable?(starting, ending)
# This Vehicle is not scheduled
# between 2015-09-01 and 2015-09-10
# => true
m = Mechanic.new m.schedulable?(starting, ending)
# This Mechanic is not scheduled
# between 2015-02-29 and 2015-09-10
# => true</code></pre><p>æ³¨æ„<code>schedulable?</code>èˆ‡<code>scheduled?</code>é€™å…©å€‹methodå› ç‚ºåœ¨Bicycleç­‰classä¸­ä¸¦æ²’æœ‰å¯¦ä½œï¼Œæ‰€ä»¥é€™äº›methodæœƒç›´æ¥å¾schedulable moduleä¸­delegate(å§”æ´¾)ï¼Œä¹Ÿå°±æ˜¯æ¡ç”¨moduleä¸­methodçš„å¯¦ä½œã€‚ä½†å› ç‚ºä¸‰å€‹classéƒ½å„è‡ªé‡æ–°å®šç¾©äº†<code>lead_days</code>ï¼Œæ‰€ä»¥<code>lead_days</code>æœƒä½¿ç”¨classè‡ªå·±å®šç¾©çš„å¤©æ•¸ã€‚</p><ul><li>ç¹¼æ‰¿èˆ‡åˆ†äº«è§’è‰²çš„å·®åˆ¥ï¼Œå…¶å¯¦å°±æ˜¯is-a(æ˜¯ä¸€å€‹xxx)èˆ‡behaviors-like-a(è¡Œç‚ºåƒæ˜¯ä¸€å€‹xxx)çš„å·®åˆ¥ã€‚</li></ul><h2>Looking Up Methods</h2><p>å°‹æ‰¾methodçš„é †åºï¼š</p><ul><li>1. å…ˆæ‰¾classä¸­æœ‰æ²’æœ‰é€™å€‹methodçš„å¯¦ä½œã€‚</li><li>2. å¦‚æœä¸Šé¢æ‰¾ä¸åˆ°ï¼Œæ‰¾class includeçš„moduleä¸­æœ‰æ²’æœ‰é€™å€‹methodçš„å¯¦ä½œã€‚</li><li>3. å¦‚æœä¸Šé¢éƒ½æ‰¾ä¸åˆ°ï¼Œå‘¼å«method_missingä¸¦å°‡methodçš„åå­—ç•¶åƒæ•¸å‚³é€²å»ï¼Œå¦‚æœæ²’æœ‰åšä»€éº¼ï¼Œæœ€å¾Œå¾€çˆ¶é¡åˆ¥ç¹¼çºŒæ‰¾methodçš„å¯¦ä½œã€‚</li></ul><h2>Inheriting Role Behavior</h2><p>moduleä¸­é‚„å¯ä»¥includeå…¶å®ƒçš„moduleï¼Œä½¿å¾—moduleè®Šæˆæœ‰ç¹¼æ‰¿é«”ç³»çš„æ„Ÿè¦ºï¼Œä½†åŒæ™‚ä¹Ÿæœƒå¢åŠ ç³»çµ±çš„è¤‡é›œåº¦ï¼Œä¹Ÿè®Šçš„æ›´é›£ç†è§£èˆ‡ç¶­è­·ï¼Œå°±çœ‹é©ä¸é©åˆé€™æ¨£å­ç”¨äº†ã€‚</p><h1>Writing Inheritable Code</h1><h2>Recognize the Antipatterns</h2><h2>Insist on the Abstraction</h2><h2>Honor the Contract</h2><h2>Use the Template Method Pattern</h2><h2>Preemptively Decouple Classes</h2><h2>Create Shallow Hierarchies</h2><h1>Summary</h1><div id="disqus_thread"></div><script>/* * * CONFIGURATION VARIABLES * * */
var disqus_shortname = 'wizard-note';
var disqus_identifier = 'ruby-poodr-ch7-sharing-role-behavior-with-modules';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script></div></div></section></div><header class="header"><table><tbody><tr><td class="hd-btn-td"><a class="hd-btn-menu" href="#" ng-class="{active: footer_ts.isTab(&#39;menu&#39;)}" ng-click="switchFooter(&#39;menu&#39;)"><div class="hd-icon"></div></a></td><td class="hd-btn-td"><a class="hd-btn-search" href="#" ng-class="{active: footer_ts.isTab(&#39;search&#39;)}" ng-click="switchFooter(&#39;search&#39;)"><div class="hd-icon"></div></a></td><td class="hd-op-td"><input class="hd-input-search" focus-if="footer_ts.isTab(&#39;search&#39;)" ng-model="query_keyword" ng-show="footer_ts.isTab(&#39;search&#39;)" /><a class="hd-trademark" href="/" ng-hide="footer_ts.isTab(&#39;search&#39;)"><img alt="é­”æ³•å¸«çš„æ‰‹æ–" src="/images/header/trademark_200x50.svg" title="é­”æ³•å¸«çš„æ‰‹æ–" /></a></td></tr></tbody></table></header><nav class="menu"><ul><li><a class="mu-btn-paper active" href="/posts"><div class="mu-icon"></div>æ–‡ç« </a></li><li><a class="mu-btn-category" href="/categories"><div class="mu-icon"></div>åˆ†é¡</a></li><li><a class="mu-btn-tag" href="/tags"><div class="mu-icon"></div>æ¨™ç±¤</a></li><li><a class="mu-btn-work" href="/works"><div class="mu-icon"></div>ä½œå“</a></li><li><a class="mu-btn-wizard" href="/about"><div class="mu-icon"></div>é—œæ–¼</a></li></ul></nav><aside class="search-result-panel" ng-show="footer_ts.isTab(&#39;search&#39;)"><div class="posts"><div class="post-list"><div class="pl-row" ng-repeat="post in getSearchPosts()"><div class="pl-cell pl-title"><div class="category-icon"><a ng-href="/categories?c={{getPostCategory(post).code}}"><div class="ca-icon-{{getPostCategory(post).code}}"></div></a></div><a href="/posts/{{post.file}}">{{post.title}}</a></div><div class="pl-cell pl-tcs"><div class="tag" ng-repeat="tag in getPostTags(post)" ng-style="{&#39;background-color&#39;:tag.color}"><a class="tag-link" ng-href="/tags?t={{tag.code}}">{{tag.name}}</a></div></div><div class="pl-cell pl-time"><div class="time">{{post.datetime}}</div></div></div></div></div></aside></body></html>
