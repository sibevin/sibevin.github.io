<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><title>docker ç­†è¨˜</title><meta content="" name="description" /><meta content="docker ç­†è¨˜" property="og:title" /><meta content="" property="og:description" /><meta content="é­”æ³•å¸«çš„æ‰‹æ–" property="og:site_name" /><link href="//cdn.jsdelivr.net/highlight.js/8.7.0/styles/hybrid.min.css" rel="stylesheet" /><link href="/css/application.css" rel="stylesheet" /><link href="/favicon.ico?" rel="shortcut icon" type="image/x-icon" /><script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script><script crossorigin="anonymous" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" src="https://code.jquery.com/jquery-2.2.4.min.js"></script><script src="//cdn.jsdelivr.net/highlight.js/8.7.0/highlight.min.js"></script><script src="//cdn.jsdelivr.net/lodash/3.10.1/lodash.min.js"></script><script src="/js/vendor/angular-tau-utils.min.js"></script><script src="/js/vendor/focusIf.min.js"></script><script src="/js/vendor/md5.min.js"></script><script src="/js/vendor/contents.js"></script><script src="/js/vendor/emojify.min.js"></script><script src="/js/app.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-26486503-2', 'auto');
ga('send', 'pageview');</script></head><body class="theme-color-default layout" ng-class="{&#39;lo-menu-open&#39;:footer_ts.isTab(&#39;menu&#39;),&#39;lo-toc-open&#39;:footer_ts.isTab(&#39;toc&#39;)}" ng-controller="LayoutCtrl" ng-keydown="layoutKeyDown($event)"><div class="main-container"><section class="main"><script>angular.module("scsBlogApp").constant("CURRENT_FILE", "2016-10-02-144725-docker-note");</script><div class="post" ng-controller="PostCtrl"><div class="title"><div class="title-img"><a href="/posts"><img src="/images/menu/paper_76x.svg" /></a></div><div class="title-main"><div class="title-text">docker ç­†è¨˜</div><div class="title-info"><div class="title-time"><div class="time">2016-10-02 14:47:25</div></div><div class="title-tcs"><div class="tag" ng-repeat="tag in getPostTags(current_post)" ng-style="{&#39;background-color&#39;:tag.color}"><a class="tag-link" ng-href="/tags?t={{tag.code}}">{{tag.name}}</a></div><div class="category-icon"><a ng-href="/categories?c={{getPostCategory(current_post).code}}"><div class="ca-icon-{{getPostCategory(current_post).code}}"></div></a></div></div></div></div></div><div class="content"><div class="meta-data">title docker ç­†è¨˜</div><div class="meta-data">datetime 2016-10-02 14:47:25</div><div class="meta-data">tags docker</div><div class="meta-data">category tools</div><div class="meta-data">link docker-note</div><div class="meta-data">file 2016-10-02-144725-docker-note</div><div class="meta-data">template post</div><div class="meta-data">end</div><h1>ä¸€èˆ¬çš„ vm èˆ‡ docker å·®åœ¨å“ªï¼Ÿ</h1><p>ä¸€èˆ¬çš„ vm æœƒåœ¨ hypervisorä¸Šå†æ¶ä¸€å€‹å®Œæ•´çš„ Guest OSï¼Œæ¥è‘—æ‰æœƒå®‰è£å°æ‡‰çš„ library èˆ‡ applicationã€‚è€Œ docker æœƒæ˜¯åŸºæ–¼ Docker Engineä¸Šè·‘å¤šå€‹ containerï¼Œæ¯ä¸€å€‹ container éƒ½æ˜¯ä¸€æ”¯ç¨ç«‹çš„ user processï¼Œå…±ç”¨ Host OS çš„ Kernelã€‚</p><div class="rwd-table"><table><tbody><tr><td>ä¸€èˆ¬çš„ vm</td><td>docker</td></tr><tr><td class="table-block"><table><tbody><tr><td>Applications 01</td><td>Applications 02</td><td>Applications 03</td></tr><tr><td>libraries 01</td><td>libraries 02</td><td>libraries 03</td></tr><tr class="text-red"><td>Guest OS 01</td><td>Guest OS 02</td><td>Guest OS 03</td></tr><tr class="text-blue"><td colspan="3">Hyervisor (ä¾‹å¦‚ï¼šVirtualBox)</td></tr><tr><td colspan="3">Host OS</td></tr></tbody></table></td><td class="table-block"><table><tbody><tr><td><span class="text-green">Container 01</span><table><tbody><tr><td>Application 01 </td></tr><tr><td>Libraries 01 </td></tr></tbody></table></td><td><span class="text-green">Container 02</span><table><tbody><tr><td>Application 02 </td></tr><tr><td>Libraries 02 </td></tr></tbody></table></td><td><span class="text-green">Container 03</span><table><tbody><tr><td>Application 03 </td></tr><tr><td>Libraries 03 </td></tr></tbody></table></td></tr><tr class="text-blue"><td colspan="3">Docker Engine</td></tr><tr><td colspan="3">Host OS</td></tr></tbody></table></td></tr></tbody></table></div><h2>Refs</h2><ul><li><a href="https://www.docker.com/what-docker" target="_blank">WHAT IS DOCKER?</a></li><li><a href="http://stackoverflow.com/questions/16047306/how-is-docker-different-from-a-normal-virtual-machine" target="_blank">SO - How is Docker different from a normal virtual machine?</a></li></ul><h1>åŸºæœ¬åè©</h1><h2>Docker Client</h2><p>ä¸€å€‹å·¥å…·ç”¨ä¾†è®“ä½¿ç”¨è€…å¯ä»¥å° Docker Daemon é€æŒ‡ä»¤èˆ‡è¨­å®šã€‚</p><h2>Docker Daemon</h2><p>ä¸€å€‹è·‘åœ¨ Host Machine çš„ç¨‹å¼ï¼Œç”¨ä¾†æ“ä½œ Dockerã€‚</p><div class="image-center"><img alt="Dockerfile, Image and Container" src="/images/post/20161002180552965-docker-image-container.png" /><div class="image-text">Dockerfile, Image and Container</div></div><h2>Dockerfile</h2><p>ä¸€å€‹æª”æ¡ˆç”¨ä¾†å®šç¾©ä¸€å€‹ Docker Image è¦æ€éº¼ç”¢ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯ Docker Image çš„åŸå§‹æª”ã€‚è£¡é¢åŒ…å«äº†å¤šå€‹æŒ‡ä»¤ä¾†æè¿° Docker Image è¦æ€éº¼è¢«å»ºç«‹ã€‚åœ¨æ•´å€‹ Docker çš„é‹ä½œä¸­åªæœƒè¢«è®€å–ç”¨ä¾†å»ºç«‹ Docker Imageï¼Œè€Œä¸æœƒè¢« Docker æ›´æ”¹ã€‚</p><h2>Docker Image</h2><p>ä¸€å€‹æª”æ¡ˆç”¨ä¾†å®šç¾©æ€éº¼å»ºç«‹ Docker Containerï¼Œå®ƒæ˜¯ Dockerfile ç”Ÿæˆçš„ç”¢ç‰©ï¼ŒåŒ…å«äº†è·‘ä¸€å€‹æ‡‰ç”¨ç¨‹å¼æ‰€éœ€çš„åŸ·è¡Œç’°å¢ƒèˆ‡å‡½å¼åº«ã€‚å¯ä»¥ä½¿ç”¨ <code>build</code>é€™å€‹æŒ‡ä»¤ä¾†å¾ Dockerfile å»ºç«‹ Docker Imageã€‚Docker Imageä¸€æ—¦è¢«å»ºç«‹ä¹‹å¾Œï¼Œå®ƒä¸æœƒè¢«æ›´æ”¹ï¼Œä½†å¯ä»¥ä½¿ç”¨é€™å€‹ image å»å»ºç«‹å¦ä¸€å€‹æ–°çš„ imageã€‚</p><h2>Docker Container</h2><p>Docker Container æ˜¯ä¸€å€‹ Docker Image çš„å¯åŸ·è¡Œå¯¦é«”(runnable instance)ï¼Œç•¶å®ƒè¢«å»ºç«‹çš„æ™‚å€™ï¼Œé™¤äº†åŒ…å«äº†å°æ‡‰çš„ Docker Image å¤–ï¼ŒDocker é‚„æœƒå»ºç«‹ä¸€å€‹å°æ‡‰çš„ read-write file system èˆ‡ä¸¦åšä¸€äº›åˆå§‹åŒ–èˆ‡ç¶²è·¯è¨­å®šã€‚ç•¶å®ƒè¢«åŸ·è¡Œæ™‚ï¼ŒDocker Container æœƒæœ‰ä¸€éš»å°æ‡‰çš„æ­£åœ¨åŸ·è¡Œä¸­çš„ processã€‚å¯ä»¥ä½¿ç”¨ <code>create</code>æŒ‡ä»¤å¾ Docker Image ä¾†å»ºç«‹ä¸€å€‹ Docker Containerã€‚ä½¿ç”¨ <code>start</code>åŸ·è¡Œ Docker Containerã€‚ä¸€å€‹æ­£åœ¨åŸ·è¡Œä¸­çš„ Docker Container ä¹Ÿæœ‰ <code>stop, restart</code>ç­‰æŒ‡ä»¤å¯ä»¥ä½¿ç”¨ã€‚</p><h2>Docker Register</h2><p>ç”¨ä¾†å­˜æ”¾ Docker Image çš„åœ°æ–¹ï¼Œç•¶éœ€è¦ä½¿ç”¨ Docker Image æ™‚ï¼Œå¯ä»¥ç›´æ¥å¾ Docker Register ä¸‹è¼‰è€Œä¸ç”¨é‡æ–° build imageã€‚</p><h2>Refs</h2><ul><li><a href="https://docs.docker.com/engine/understanding-docker/" target="_blank">Docker Overview</a></li><li><a href="http://stackoverflow.com/questions/23735149/docker-image-vs-container" target="_blank">SO - Docker image vs container</a></li></ul><h1>æŒ‡ä»¤</h1><h2>docker ps</h2><p>åˆ—å‡ºæ­£åœ¨åŸ·è¡Œ(running)çš„containerã€‚</p><ul><li>-a åˆ—å‡ºæ‰€æœ‰çš„containgerã€‚</li></ul><h2>docker run [image]</h2><p>å–å¾—imageã€å»ºç«‹containerä¸¦åŸ·è¡Œã€‚</p><ul><li>-t åˆ†é…ä¸€å€‹è™›æ“¬çµ‚ç«¯ï¼ˆpseudo-ttyï¼‰ä¸¦ç¶å®šåˆ°containerçš„æ¨™æº–è¼¸å…¥ã€‚</li><li>-i ä½¿ç”¨interactionæ¨¡å¼ï¼Œè®“containerçš„æ¨™æº–è¼¸å…¥ä¿æŒé–‹å•Ÿç‹€æ…‹ï¼Œä½¿ç”¨è€…å¯ä»¥ç”±æ­¤è¼¸å…¥æŒ‡ä»¤ã€‚</li><li>å¦‚æœéœ€è¦ä¸€å€‹consoleé€£åˆ°containerï¼Œå‰‡ -i èˆ‡ -t å¿…é ˆè¦ä¸€èµ·ç”¨ï¼Œå¯ä»¥ç¸®å¯«æˆ -it ã€‚</li><li>--rm ç•¶é›¢é–‹containeræ™‚ï¼Œæ¸…é™¤æ‰€æœ‰çš„è³‡æ–™èˆ‡file systemï¼Œè¦æ³¨æ„çš„æ˜¯æœƒé€£volumnéƒ½æœƒä¸€èµ·åˆªã€‚</li></ul><h3>docker search [keyword]</h3><p>æŸ¥è©¢Docker Hubä¸Šçš„imageã€‚</p><h3>docker images</h3><p>åˆ—å‡ºæ‰€æœ‰çš„imageã€‚</p><h3>docker stop [container]</h3><p>åœæ­¢ç›®å‰æ­£åœ¨é‹ä½œçš„containerã€‚</p><h3>docker rm [container]</h3><p>ç§»é™¤containerã€‚</p><h3>docker inspect [container]</h3><p>å–å¾—ç›®å‰containerçš„è³‡è¨Šã€‚</p><h1>ä½¿ç”¨ç¯„ä¾‹</h1><h2>ç¯„ä¾‹ï¼šä¸€å€‹å»ºç«‹phoenixç’°å¢ƒçš„Dockerfile</h2><pre><code class="dockerfile">FROM elixir:1.4.2-slim

RUN apt-get update && apt-get upgrade -y && \
    apt-get install -y curl sudo && \
    curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash - && sudo apt-get install -y nodejs

RUN mix local.hex --force && \
    mix archive.install --force https://github.com/phoenixframework/archives/raw/master/phoenix_new.ez

CMD ["/bin/bash"]</code></pre><h2>ç¯„ä¾‹ï¼šèµ·ä¸€å€‹mysqlçš„dockerï¼Œä¸¦ä¸”è®“hostçš„mysql clientå¯ä»¥é€£åˆ°å®ƒã€‚</h2><ul><li>å»ºç«‹ä¸€å€‹ docker-compose.yml å¦‚ä¸‹ï¼š</li></ul><pre><code class="yaml">version: "3"
services:
  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: "yit0v5911gcfckbd1guk2ctumrdcy8nb"
    ports:
      - "7364:3306"</code></pre><ul><li>åŸ·è¡Œ<code>docker-compose up</code></li><li>é€£ç·š<code>mysql -h 127.0.0.1 -P 7364 -u root -p</code></li></ul><h2>ç¯„ä¾‹ï¼šèµ·ä¸€å€‹ debian server èˆ‡ mysql server çš„dockerï¼Œä¸¦ä¸”è®“ debian server å¯ä»¥é€£åˆ° mysql serverã€‚</h2><ul><li>å»ºç«‹ä¸€å€‹ docker-compose.yml å¦‚ä¸‹ï¼š</li></ul><pre><code class="yaml">version: "3"
services:
  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: "lvkn9ey1bcty55ghmyedncr79ycdcvgo"
  server:
    image: debian:jessie
    stdin_open: true
    tty: true</code></pre><ul><li>åŸ·è¡Œ<code>docker-compose up</code></li><li>åŸ·è¡Œ<code>docker attach [debian_server_container_name]</code>é€²å…¥ server çš„ containerã€‚å…¶ä¸­debian_server_container_nameå³æ˜¯å°æ‡‰debian containerçš„nameã€‚ç•¶ä½ åŸ·è¡Œdocker-compose upçš„æ™‚å€™ï¼Œlogå°±æœƒé¡¯ç¤ºcontainerçš„åç¨±ã€‚</li><li>å®‰è£ mysql-client<code>root@210978bba57f:/# apt-get update && apt-get upgrade && apt-get install mysql-client</code></li><li>é€£ç·šè‡³mysql<code>root@210978bba57f:/# mysql -hdb -P3306 -uroot -p</code>ã€‚å…¶ä¸­æˆ‘å€‘æŠŠhostè¨­æˆdbï¼Œé€™æ˜¯å› ç‚ºdocker composeçš„åŠŸèƒ½ï¼Œå®ƒå°‡åŒä¸€å€‹composeä¸‹çš„serviceéƒ½æ”¾åœ¨åŒä¸€å€‹private networkä¸­ï¼Œè€Œåœ¨compose.ymlè£¡è¨­å®šçš„serviceåç¨±å°±å¯ä»¥ç”¨ä¾†ä»£è¡¨serverå°æ‡‰çš„ipä½å€ã€‚</li></ul><h2>Refs</h2><ul><li><a href="https://docs.docker.com/compose/networking/" target="_blank">Docker Doc - Networking in Compose</a></li></ul><h1>Resources</h1><h2>Links</h2><ul><li><a href="https://www.gitbook.com/book/philipzheng/docker_practice/details" target="_blank">ã€ŠDocker â€”â€” å¾å…¥é–€åˆ°å¯¦è¸Â­ã€‹æ­£é«”ä¸­æ–‡ç‰ˆ</a></li><li><a href="http://www.slideshare.net/trunk-studio/docker-65378344" target="_blank">å‰µç§‘ å¾é›¶é–‹å§‹èªè­˜ Docker</a></li><li><a href="http://bingohuang.com/simplify-docker-image-1/" target="_blank">7 æ­¥ç²¾ç®€ Docker é•œåƒï¼ˆä¸Šï¼‰</a></li><li><a href="http://bingohuang.com/simplify-docker-image-2/" target="_blank">7 æ­¥ç²¾ç®€ Docker é•œåƒï¼ˆä¸‹ï¼‰</a></li><li><a href="http://blog.runnable.com/post/145895165446/9-common-dockerfile-mistakes" target="_blank">9 Common Dockerfile Mistakes</a></li><li><a href="http://container-solutions.com/understanding-volumes-docker/" target="_blank">Understanding Volumes in Docker</a></li><li><a href="http://dockone.io/" target="_blank">DockOne.ioï¼Œæœ€ä¸“ä¸šçš„Dockeräº¤æµå¹³å°</a></li><li><a href="https://thehftguy.com/2016/11/01/docker-in-production-an-history-of-failure/" target="_blank">Docker in Production: A History of Failure</a></li></ul><h2>Books</h2><ul><li><a href="https://www.openshift.com/promotions/docker-security.html" target="_blank">Docker Security: Using Containers Safely in Production - Adrian Mouat</a></li></ul><div id="disqus_thread"></div><script>/* * * CONFIGURATION VARIABLES * * */
var disqus_shortname = 'wizard-note';
var disqus_identifier = 'docker-note';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script></div></div></section></div><header class="header"><table><tbody><tr><td class="hd-btn-td"><a class="hd-btn-menu" href="#" ng-class="{active: footer_ts.isTab(&#39;menu&#39;)}" ng-click="switchFooter(&#39;menu&#39;)"><div class="hd-icon"></div></a></td><td class="hd-btn-td" ng-show="has_toc"><a class="hd-btn-toc" href="#" ng-class="{active: footer_ts.isTab(&#39;toc&#39;)}" ng-click="switchFooter(&#39;toc&#39;)"><div class="hd-icon"></div></a></td><td class="hd-btn-td"><a class="hd-btn-search" href="#" ng-class="{active: footer_ts.isTab(&#39;search&#39;)}" ng-click="switchFooter(&#39;search&#39;)"><div class="hd-icon"></div></a></td><td class="hd-op-td"><input class="hd-input-search" focus-if="footer_ts.isTab(&#39;search&#39;)" ng-model="query_keyword" ng-show="footer_ts.isTab(&#39;search&#39;)" /><a class="hd-trademark" href="/" ng-hide="footer_ts.isTab(&#39;search&#39;)"><img alt="é­”æ³•å¸«çš„æ‰‹æ–" height="50" src="/images/header/trademark_50x.svg" title="é­”æ³•å¸«çš„æ‰‹æ–" width="50" /></a></td></tr></tbody></table></header><nav class="menu"><ul><li><a class="mu-btn-paper active" href="/posts"><div class="mu-icon"></div>æ–‡ç« </a></li><li><a class="mu-btn-category" href="/categories"><div class="mu-icon"></div>åˆ†é¡</a></li><li><a class="mu-btn-tag" href="/tags"><div class="mu-icon"></div>æ¨™ç±¤</a></li><li><a class="mu-btn-work" href="/works"><div class="mu-icon"></div>ä½œå“</a></li><li><a class="mu-btn-wizard" href="/about"><div class="mu-icon"></div>é—œæ–¼</a></li></ul></nav><nav class="toc"></nav><aside class="search-result-panel" ng-show="footer_ts.isTab(&#39;search&#39;)"><div class="posts"><div class="post-list"><div class="pl-row" ng-repeat="post in getSearchPosts()"><div class="pl-cell pl-title"><div class="category-icon"><a ng-href="/categories?c={{getPostCategory(post).code}}"><div class="ca-icon-{{getPostCategory(post).code}}"></div></a></div><a href="/posts/{{post.file}}">{{post.title}}</a><a href="{{post.website}}" ng-show="post.website" target="_blank"><img class="pl-weblink" src="/images/list/weblink_25x.svg" /></a></div><div class="pl-cell pl-tcs"><div class="tag" ng-repeat="tag in getPostTags(post)" ng-style="{&#39;background-color&#39;:tag.color}"><a class="tag-link" ng-href="/tags?t={{tag.code}}">{{tag.name}}</a></div></div><div class="pl-cell pl-time"><div class="time">{{post.datetime}}</div></div></div></div></div></aside></body><script>$(function () {
  // TOC
  try {
    var contents,
        articleId;
    articleId = function (articleName, element) {
      return md5(articleName + element.previousSibling.innerText + element.nextSibling.innerText);
    };
    contents = gajus
      .Contents({articleId: articleId});
    $('.toc').append(contents.list());
  } catch(e) {
  }
  // emoji
  emojify.setConfig({
    ignore_emoticons: true,
    img_dir: '/images/emoji',
    blacklist: {
      elements: ['script', 'textarea', 'pre', 'code'],
      classes: ['no-emojify']
    }
  });
  emojify.run();
});</script></html>
